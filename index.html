<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OK School Life - ç½‘é¡µç»ˆç«¯ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --input-bg: #2d2d2d;
            --accent-color: #4CAF50;
            --error-color: #ff5555;
        }
        body {
            font-family: 'Courier New', monospace;
            background-color: var(--bg-color);
            color: var(--text-color);
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.5;
        }
        #terminal {
            background-color: #121212;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 15px;
            height: 60vh;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        #input-container {
            display: flex;
            margin-top: 10px;
        }
        #prompt {
            color: var(--accent-color);
            margin-right: 5px;
            line-height: 40px;
        }
        #input {
            flex-grow: 1;
            background: var(--input-bg);
            color: var(--text-color);
            border: none;
            padding: 10px;
            font-family: inherit;
            border-radius: 3px;
        }
        .cmd-line {
            margin: 5px 0;
        }
        .error {
            color: var(--error-color);
        }
    </style>
</head>
<body>
    <h1>ğŸ® OK School Life</h1>
    <div id="terminal"></div>
    
    <div id="input-container">
        <div id="prompt">>></div>
        <input type="text" id="input" placeholder="ç­‰å¾…åˆå§‹åŒ–å®Œæˆ..." disabled>
    </div>

    <script>
        const terminal = document.getElementById('terminal');
        const input = document.getElementById('input');
        let pyodide;
        let gameRunning = false;

        function print(text, isError = false) {
            const line = document.createElement('div');
            line.className = 'cmd-line' + (isError ? ' error' : '');
            line.textContent = text;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }

        async function initPyodide() {
            print("ğŸš€ æ­£åœ¨åˆå§‹åŒ–Pyodide...");
            
            try {
                pyodide = await loadPyodide({
                    indexURL: "https://cdn.jsdelivr.net/pyodide/v0.23.4/full/",
                    stdout: (text) => print(text),
                    stderr: (text) => print(text, true)
                });

                // ä¿®æ”¹æ¸¸æˆä¸»å¾ªç¯é€»è¾‘
                await pyodide.runPythonAsync(`
                import sys
                from js import document

                game_state = {
                    'running': True,
                    'current_menu': 'main'
                }

                def show_menu(menu_type):
                    if menu_type == 'main':
                        print("æ¬¢è¿æ¥åˆ°OK School Life beta v0.2.7ï¼")
                        print("ä½ å°†ç»å†ä¸åŒçš„äº‹ä»¶å’Œé€‰æ‹©ï¼Œçœ‹çœ‹ä½ çš„å­¦æ ¡ç”Ÿæ´»ä¼šå¦‚ä½•å‘å±•ã€‚")
                        print("æŒ‰'1'ä»¥å¼€å§‹æ¸¸æˆï¼ŒæŒ‰'2'ä»¥é€€å‡ºï¼š")
                    return menu_type

                def handle_input(user_input):
                    if game_state['current_menu'] == 'main':
                        if user_input == '1':
                            game_state['current_menu'] = 'game'
                            print("æ¸¸æˆå¼€å§‹ï¼")
                        elif user_input == '2':
                            game_state['running'] = False
                            print("æ¸¸æˆç»“æŸ")
                        else:
                            print("æ— æ•ˆçš„è¾“å…¥ï¼Œè¯·é‡æ–°è¾“å…¥")
                            show_menu('main')
                    return game_state['running']
                `);

                // åŠ è½½æ¸¸æˆä»£ç ï¼ˆå·²ä¿®æ”¹é€’å½’é—®é¢˜ï¼‰
                const response = await fetch('ok_school_life.py');
                const code = await response.text();
                
                // æ›¿æ¢åŸæ¸¸æˆä¸»å¾ªç¯
                const fixedCode = code.replace(
                    /def start\(.*?\).*?while True:/s,
                    `def start():
                        show_menu('main')
                        return True`
                );
                
                await pyodide.runPythonAsync(fixedCode);
                gameRunning = true;
                input.disabled = false;
                input.placeholder = "è¾“å…¥æŒ‡ä»¤åæŒ‰å›è½¦...";
                input.focus();
                
            } catch (err) {
                print(`åˆå§‹åŒ–å¤±è´¥: ${err}`, true);
                console.error(err);
            }
        }

        input.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter' && gameRunning) {
                const cmd = input.value.trim();
                input.value = '';
                print(`>> ${cmd}`);
                
                try {
                    const shouldContinue = await pyodide.runPythonAsync(`
                    handle_input(${JSON.stringify(cmd)})
                    `);
                    
                    if (!shouldContinue) {
                        gameRunning = false;
                        input.disabled = true;
                        print("æ„Ÿè°¢æ¸¸ç©ï¼åˆ·æ–°é¡µé¢å¯é‡æ–°å¼€å§‹");
                    }
                } catch (err) {
                    print(`æ‰§è¡Œé”™è¯¯: ${err}`, true);
                }
            }
        });

        // å¯åŠ¨
        initPyodide();
    </script>
</body>
</html>